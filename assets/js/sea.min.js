function getRandomWithinRange(e,n){return Math.random()*(n-e)+e}function sketchProc(e){e.setup=function(){e.size(WIDTH,HEIGHT),e.frameRate(30)},e.draw=function(){e.background(255);var n=+new Date,t=n-lastUpdate;lastUpdate=n,updateWave(t),drawWave()}}function updateWave(){offset+=1;for(var e=0;ITERATIONS>e;e++)for(var n=0;n<wavePoints.length;n++){var t,a,s=wavePoints[n],i=0;if(0==n){var o=wavePoints[wavePoints.length-1].y-s.y;t=SPRING_CONSTANT*o}else{var o=wavePoints[n-1].y-s.y;t=SPRING_CONSTANT*o}if(n==wavePoints.length-1){var o=wavePoints[0].y-s.y;a=SPRING_CONSTANT*o}else{var o=wavePoints[n+1].y-s.y;a=SPRING_CONSTANT*o}var o=Y_OFFSET-s.y;forceToBaseline=SPRING_CONSTANT_BASELINE*o,i+=t,i+=a,i+=forceToBaseline;var r=i/s.mass;s.spd.y=DAMPING*s.spd.y+r,s.y=s.y+s.spd.y,wavePoints[n]=s}}function drawWave(){var e=pjs.externals.context,n=e.createLinearGradient(.5*WIDTH,.2*HEIGHT,.5*WIDTH,HEIGHT);n.addColorStop(0,"#00c0ee"),n.addColorStop(1,"rgba(0,170,255,0)"),e.clearRect(0,0,WIDTH,HEIGHT),e.fillStyle=n,e.beginPath();var t=wavePoints[0].x,a=wavePoints[0].y+overlapSines(wavePoints[0].x),s=wavePoints[wavePoints.length-1].x,i=wavePoints[wavePoints.length-1].y+overlapSines(wavePoints[wavePoints.length-1].x);moveTo(t,a);var o,r,v,N,S,f,P,I,T,A,w=wavePoints.length;for(o=0;w>o;o++)r=wavePoints[o],v=wavePoints[o-1],N=wavePoints[o+1],v&&N&&(S=v.x,f=v.y+overlapSines(v.x),P=r.x,I=r.y+overlapSines(r.x),T=S+(P-S)/2,A=f+(I-f)/2,e.quadraticCurveTo(S,f,T,A));e.lineTo(s,i),e.lineTo(WIDTH,HEIGHT),e.lineTo(0,HEIGHT),e.lineTo(t,a),e.fill()}function createPoints(){for(var e=7,n=e+3,t=[],a=0;n>a;a++){var s={x:a/e*WIDTH,y:Y_OFFSET,spd:{y:0},mass:1};t.push(s)}return t}function overlapSines(e){for(var n=0,t=0;NUM_BACKGROUND_WAVES>t;t++)n=n+sineOffsets[t]+sineAmplitudes[t]*Math.sin(e*sineStretches[t]+offset*offsetStretches[t]);return n}function resizeCanvas(){WIDTH=window.innerWidth,HEIGHT=window.innerHeight,wavePoints=createPoints(),pjs.size(window.innerWidth,window.innerHeight)}function createWave(){for(var e=null,n=-1,t=0;t<wavePoints.length;t++){var a=wavePoints[t],s=Math.abs(pjs.mouseX-a.x);-1!=n?n>=s&&(e=a,n=s):(e=a,n=s)}e.y=pjs.mouseY}for(var WIDTH=window.innerWidth,HEIGHT=window.innerHeight,SPRING_CONSTANT=.005,SPRING_CONSTANT_BASELINE=.005,Y_OFFSET=Math.round(HEIGHT/2),DAMPING=.975,ITERATIONS=4,NUM_BACKGROUND_WAVES=2,BACKGROUND_WAVE_MIN_HEIGHT=3,BACKGROUND_WAVE_MAX_HEIGHT=9,BACKGROUND_WAVE_MIN_COMPRESSION=.1,BACKGROUND_WAVE_MAX_COMPRESSION=1/8,sineOffsets=[],sineAmplitudes=[],sineStretches=[],offsetStretches=[],lastUpdate=+new Date,offset=0,canvas=null,pjs=null,wavePoints=null,i=0;NUM_BACKGROUND_WAVES>i;i++){var sineOffset=-Math.PI+2*Math.PI*Math.random();sineOffsets.push(sineOffset);var sineAmplitude=getRandomWithinRange(BACKGROUND_WAVE_MIN_HEIGHT,BACKGROUND_WAVE_MAX_HEIGHT);sineAmplitudes.push(sineAmplitude);var sineStretch=getRandomWithinRange(BACKGROUND_WAVE_MIN_COMPRESSION,BACKGROUND_WAVE_MAX_COMPRESSION);sineStretches.push(sineStretch);var offsetStretch=getRandomWithinRange(BACKGROUND_WAVE_MIN_COMPRESSION,BACKGROUND_WAVE_MAX_COMPRESSION);offsetStretches.push(offsetStretch)}$(function(){wavePoints=createPoints(),canvas=document.getElementById("sea"),pjs=new Processing(canvas,sketchProc),$(window).resize(resizeCanvas),$(document).on("mousedown",createWave)});